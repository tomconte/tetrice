## Build Steps for tetrice_alice Explained

The `tetrice_alice` target in the Makefile performs a complex multi-step build process using the CC6303 toolchain. Here's what each step does:

### Step 1-2: C Compilation to Assembly (cc68)
```makefile
$(CC68)/lib/cc68 -I $(CC68)/include/mc10/ -I $(CC68)/include/ -r --add-source --cpu 6803 -D__6803__ -D__TANDY_MC10__ $(ALICE_FLAGS) $(SRC) > tetrice_temp.s
$(CC68)/lib/cc68 -I $(CC68)/include/mc10/ -I $(CC68)/include/ -r --add-source --cpu 6803 -D__6803__ -D__TANDY_MC10__ $(ALICE_FLAGS) $(ALICE_PLATFORM_SRC) > platform_alice_temp.s
```

**What cc68 does:** The C compiler that compiles C source code into assembly language for 6800-series processors.

**Arguments explained:**
- `-I $(CC68)/include/mc10/` & `-I $(CC68)/include/` - Include directories for header files
- `-r` - Enable register variables (optimization)
- `--add-source` - Include original C source as comments in the assembly output (helpful for debugging)
- `--cpu 6803` - Target the 6803 processor specifically
- `-D__6803__` & `-D__TANDY_MC10__` - Define preprocessor symbols for conditional compilation
- `$(ALICE_FLAGS)` - Additional Alice-specific flags (`-DALICE`)

**Output:** Generates tetrice_temp.s and platform_alice_temp.s - unoptimized assembly files with source comments.

### Step 3-4: Assembly Optimization (copt)
```makefile
$(CC68)/lib/copt $(CC68)/lib/cc68.rules < tetrice_temp.s > tetrice.s
$(CC68)/lib/copt $(CC68)/lib/cc68.rules < platform_alice_temp.s > platform_alice.s
```

**What copt does:** A peephole optimizer that applies pattern-matching rules to improve the assembly code generated by the compiler.

**Arguments explained:**
- `$(CC68)/lib/cc68.rules` - The optimization rules file containing patterns to match and optimize
- Input/output via pipes: reads assembly from stdin, outputs optimized assembly to stdout

**Process:** copt performs multiple optimization passes (up to 16) applying rules like:
- Removing redundant load/store operations
- Eliminating dead code
- Optimizing instruction sequences
- Using more efficient instruction forms

**Output:** Generates tetrice.s and platform_alice.s - optimized assembly files.

### Step 5-6: Assembly to Object Code (as68)
```makefile
$(CC68)/bin/as68 tetrice.s
$(CC68)/bin/as68 platform_alice.s
```

**What as68 does:** The assembler that converts assembly language into relocatable object code.

**Process:** 
- Performs multiple passes to resolve symbols and addresses
- Converts mnemonics to machine code
- Handles labels, directives, and data definitions
- Creates symbol tables for linking

**Output:** Generates tetrice.o and platform_alice.o - object files containing machine code but not yet linked.

### Step 7: Linking (ld68)
```makefile
$(CC68)/bin/ld68 -b -C $(ALICE_ADDR) -Z 0x90 -o tetrice $(CC68)/lib/crt0_mc10.o tetrice.o platform_alice.o $(CC68)/lib/libc.a $(CC68)/lib/libio6803.a $(CC68)/lib/libmc10.a $(CC68)/lib/lib6803.a
```

**What ld68 does:** The linker that combines object files and libraries into a final executable.

**Arguments explained:**
- `-b` - Output absolute binary format (not relocatable)
- `-C $(ALICE_ADDR)` - Set CODE segment base address to `14150` (the Alice's memory location)
- `-Z 0x90` - Set ZP/DP (Zero Page/Direct Page) segment base address to `0x90`
- `-o tetrice` - Output filename
- `$(CC68)/lib/crt0_mc10.o` - C runtime startup code for MC-10
- `tetrice.o platform_alice.o` - Your compiled object files
- Various `.a` files - Standard libraries (C library, I/O library, MC-10 specific library, 6803 library)

**Process:**
- Resolves all symbol references between object files and libraries
- Assigns final memory addresses to all code and data
- Creates a single executable binary

**Output:** Generates tetrice - the final executable binary.

### Step 8: Tape Format Creation (mc10-tapeify)
```makefile
wlen=$$(expr $$(wc -c < tetrice | awk '{print $$1}') - $(ALICE_ADDR)); $(CC68)/lib/mc10-tapeify tetrice tetrice.c10 $(ALICE_ADDR) $$wlen $(ALICE_ADDR)
```

**What this does:** Converts the binary executable into a format suitable for loading on the MC-10/Alice computer from tape.

**Process breakdown:**
1. `wc -c < tetrice` - Count bytes in the binary
2. `expr ... - $(ALICE_ADDR)` - Calculate the length by subtracting the load address
3. `mc10-tapeify` - Convert binary to tape format with:
   - Input file: tetrice
   - Output file: `tetrice.c10`
   - Load address: `$(ALICE_ADDR)` (14150)
   - Length: calculated `wlen`
   - Start address: `$(ALICE_ADDR)` (where execution begins)

**Output:** Generates `tetrice.c10` - a tape image file that can be loaded into an MC-10/Alice emulator or transferred to real hardware.

### Summary
The entire process transforms C source code through: **C → Assembly → Optimized Assembly → Object Code → Linked Executable → Tape Format**, creating a program that can run on the Alice/MC-10 computer starting at memory address 14150.
