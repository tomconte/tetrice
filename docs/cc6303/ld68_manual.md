# User Manual for `ld.c` (6800 Series Linker)

This program is a linker for object files generated by the CC6303 C compiler for the 6800 series processors. It supports linking multiple object files and libraries, relocates code/data, and generates executables or relocatable binaries.

---

## Usage

```
ld [options] object_files_and_libraries...
```

### Main Workflow

- Loads object files and libraries in command-line order.
- Resolves symbols, computes segment sizes, and assigns base addresses.
- Produces output in various formats: relocatable object, absolute executable, or Fuzix binary.
- Optionally generates a map file with symbol details.

---

## Command-Line Options

| Option    | Description                                                                                     |
|-----------|------------------------------------------------------------------------------------------------|
| `-r`      | Output an object module (relocatable format).                                                  |
| `-b`      | Output a linked binary (absolute format); also strips symbols.                                 |
| `-v`      | Print version information (`FuzixLD 0.2.1`).                                                   |
| `-t`      | Verbose reporting; prints detailed linking info.                                               |
| `-s`      | Strip symbols from output.                                                                     |
| `-i`      | Split code and data segments both to zero base (for split I/D systems).                        |
| `-u sym`  | Insert an undefined internal symbol named `sym`.                                               |
| `-o file` | Specify output file name (default: `a.out`).                                                   |
| `-m file` | Generate a map file with symbol info to `file`.                                                |
| `-f ord`  | Specify segment order; default is `"CLDBX"`.                                                   |
| `-R file` | Write relocation information to `file`.                                                        |
| `-A val`  | Set segment alignment (default: 1).                                                            |
| `-B val`  | Set base address for BSS segment.                                                              |
| `-C val`  | Set base address for CODE segment.                                                             |
| `-D val`  | Set base address for DATA segment.                                                             |
| `-S val`  | Set base address for Shared/Common segment.                                                    |
| `-X val`  | Set base address for DISCARD segment.                                                          |
| `-Z val`  | Set base address for ZP/DP segment.                                                            |
| `-8 val`  | Set base address for an additional segment (index 8).                                          |

**Note:** Setting base addresses is only allowed in absolute mode (`-b` option).

---

## Arguments

- List object files and/or libraries to be linked.
- Libraries (archive files) are scanned for needed modules when unresolved symbols are present.

---

## Output Modes

1. **Relocatable Object (`-r`)**: Outputs a single `.o` file with internal references resolved. Undefined symbols are allowed.
2. **Absolute Binary (`-b`)**: Outputs a binary with all relocations performed and no undefined symbols.
3. **Fuzix Binary**: Default mode, outputs for the Fuzix OS. Relocatable Fuzix binaries live at logical address 0.

---

## Map File

If `-m <file>` is specified, a map file is generated, listing all symbols, their addresses, and types.

---

## Segment Names

Segments can be referenced by the following letters (for `-f` order or base address options):

- `C` - CODE
- `D` - DATA
- `B` - BSS
- `Z` - ZP/DP
- `X` - DISCARD
- `S` - Shared/Common
- `L` - LITERAL
- `8` - Additional segment

---

## Example Usage

Link two object files and a library, outputting to `prog.bin` in absolute mode, generating a map file:

```sh
ld -b -o prog.bin -m map.txt file1.o file2.o libsomething.a
```

---

## Verbose Operation

Add `-t` for detailed output about segment sizes, symbol resolution, and memory map computation:

```sh
ld -t -o prog.bin file1.o file2.o
```

---

## Error Handling

- Reports errors for bad object files, symbol conflicts, relocation failures, and segment overflows.
- Exits with a non-zero status on failure.

---

## Symbol Handling

- Supports internal linker symbols for segment starts/ends and sizes (e.g., `__code`, `__data_size`).
- Can insert custom undefined symbols using `-u <symbol>`.

---

## Version

Print version info using:

```sh
ld -v
```

Outputs: `FuzixLD 0.2.1`

---

## Notes

- Only set segment base addresses in absolute mode (`-b`).
- Libraries should be listed before dependencies (e.g., `termcap.a` before `libc.a`).
- Relocation and symbol stripping supported via options.
